<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>nextTick</title>
</head>
<body>

<script>
    /*问题 : 你知道nextTick的原理吗？
    回答:
    1.vue用异步队列的方式来控制dom更新和nextTick回调的先后执行顺序
    2.因为微任务优先级比较高,可以确保队列里面微任务在一次事件循环前被执行完毕
    3.因为兼容性问题,vue不得不做微任务向宏任务的降级处理


    其他:

        vue不建议直接操作dom,但是有些场景又必须操作dom,所以做vue给dom操作提供了一个api,
        nextTick的,在dom更新完毕后,做的dom操作,
        源码里面也的nextTick里面会做兼容降级,如果支持MutationObserver,会使用这个H5的api,
        dom更新完毕后,做这个nextTick的回调操作,
        如果用户自己调用了nextTick,就会在更新dom的那个微任务后面追加用户定义的回调函数,确保代码在dom更新后执行

        **dom更新和重绘是两件事情

      在源码层级,更新视图需要触发watcher的update,如果是异步任务触发的watcher的update,
      会走进去queueWatcher,把这些异步任务的watcher加到异步任务队列中
      然后判断环境,优先用微任务执行,然后用宏任务,逐渐降级,在同步任务执行完毕之后,最后会把任务队列里面watcher一个一个执行清空,
      当然添加进去的时候会根据id去重判断


      这个涉及到vue里面异步任务的问题,nextTick的回调会被添加进入vue一个执行异步任务队列,在前面的异步任务执行完毕之后才执行

      如果把异步任务放在nextTick里面作为回调,那么会确保是代码里面执行完毕了异步任务队列所有任务之后才执行的,确保执行时机

    * */
</script>
</body>
</html>
